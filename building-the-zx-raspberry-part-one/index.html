
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="The personal blog of PJ Evans">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Nothing+You+Could+Do&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Coustard&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <link href="/src/css/mrpjevans.css" rel="stylesheet">

		<link rel="icon" type="image/png" size="256x256" href="/images/pj-blog-logo-256.png">

		<link rel="icon" type="image/png" size="512x512" href="/images/pj-blog-logo-512.png">

		<link rel="alternate" type="application/rss+xml" title="Mr PJ Evans Blog Feed" href="https://mrpjevans.com/feed/feed.xml">

		<title>Mr PJ Evans | Building The ZX Raspberry – Part One</title>

  </head>
  <body data-bs-theme="dark">

    <div class="container">
      <div class="row justify-content-md-center">
        <div class="col-md-8 col-sm-12 col-lg-6">

					<header>
						<nav class="navbar bg-dark navbar-expand-lg border-bottom border-body" data-bs-theme="dark">
							<div class="container-fluid">
								<a class="navbar-brand logo" href="/">Mr PJ Evans</a>
								<div>
									<div>
										<ul class="navbar-nav me-auto mb-2 mb-lg-0">
											<li class="nav-item">
											<a class="nav-link " href="/tags">Tags</a>
											</li>
											<li class="nav-item">
												<a class="nav-link " href="/about">About</a>
											</li>
										</ul>
									</div>	
								</div>
							</div>
						</nav>
					</header>

					<main>
          	
  

  

  

  
    
    


    <h1 class="h1-with-date">Building The ZX Raspberry – Part One</h1>

<p class="meta-date text-center">08 Dec 2015</p>

<picture><source type="image/webp" srcset="/images/IMG_2359-2000w.webp 2000w"><img src="/images/IMG_2359-2000w.jpeg" alt="" width="2000" height="1500"></picture>

<article>
  <p><em>In which our hero plans and schemes</em></p><p>Despite wanting to convert a ZX Spectrum into a USB keyboard for some time, I held off to wait for the unlikely duo of the <a href="http://retro-computers.co.uk/?ref=stowe.local">ZX Spectrum Vega</a> and the <a href="http://sinclair.recreatedzxspectrum.com/?ref=stowe.local">Recreated ZX Spectrum</a>. Sadly, neither buttered my parsnips, and the reasons why have been discussed at length around this Internet of ours, so I shall say no more here. What I really wanted a combination of the two: The stand-alone operation of the Vega and the keyboard of the ‘Recreated’.</p><p>Not being one to re-invent the wheel, I’d been reading over <a href="http://www.instructables.com/id/Convert-a-ZX82-Spectrum-keyboard-into-an-expandabl/?ref=stowe.local">this Instructable wot I found</a> and occasionally drooling over the excellent kits offered by <a href="http://blog.tynemouthsoftware.co.uk/?ref=stowe.local">Tynemouth Software</a>. Then, a battered old Speccy case and the parts needed for a USB interface found their way onto a Facebook group for just £20, their current owner being caught between retro-project-awesomeness and ‘having a life’ and ‘friends’. Clearly making the wrong choice, he put them up for sale.</p><p>Here’s what arrived:</p><figure class="kg-card kg-image-card kg-card-hascaption"><picture><source type="image/webp" srcset="/images/IMG_2219-2000w.webp 2000w"><img src="/images/IMG_2219-2000w.jpeg" class="kg-image" alt="" loading="lazy" width="2000" height="1500"></picture><figcaption>Yay! Bits!</figcaption></figure><p>Ok, so some assembly required. A few re-reads of the Instructable article later and I had my head around what was going to happen. At the heart of this little enterprise is the iddy-biddy <a href="https://www.sparkfun.com/products/12640?ref=stowe.local">Pro Micro</a>, which is a clone of the <a href="https://www.arduino.cc/en/Main/ArduinoBoardLeonardo?ref=stowe.local">Arduino Leonardo</a>, a popular micro-controller. The Leonardo has a major trick up its sleeve compared to the more commonly-encountered <a href="https://www.arduino.cc/en/Main/ArduinoBoardUno?ref=stowe.local">Uno</a>: Its USB port can be addressed, allowing you to easily create a new USB device. In fact, when you first hook it up to a Mac, the Mac thinks a keyboard has been attached (which is handy). So, a load of inputs to one USB output.</p><p>The Speccy’s keyboard uses a thin plastic membrane sandwich with two layers of electrical tracks which form a matrix grid of 5 by 8 tracks. When a key is pressed it creates a circuit between two of these tracks that are connected to the motherboard. Each key ‘lights up’ a unique pair of tracks. The tracks lead into two ribbon cables that go from the keyboard assembly to the motherboard. These are known as the ‘data’ and ‘address’ cables and only one wire on each will light up per keypress. The ribbon itself is very, very delicate and normally the first thing to fail on a Speccy, causing any keys on the broken line to fail. Newly manufactured replacements are available that are a lot more sturdy should they be needed.</p><figure class="kg-card kg-image-card kg-card-hascaption"><picture><source type="image/webp" srcset="/images/IMG_2240-2000w.webp 2000w"><img src="/images/IMG_2240-2000w.jpeg" class="kg-image" alt="" loading="lazy" width="2000" height="1500"></picture><figcaption>The 2 ribbons that make up the keyboard matrix</figcaption></figure><figure class="kg-card kg-image-card kg-card-hascaption"><picture><source type="image/webp" srcset="/images/key_spec-700w.webp 700w"><img src="/images/key_spec-700w.jpeg" class="kg-image" alt="" loading="lazy" width="700" height="808"></picture><figcaption>Layout of the ZX Spectrum keyboard matrix (author unknown)</figcaption></figure><p>The deal is this: Hook up the Speccy’s keyboard matrix to the Pro Micro’s input lines (of which it has many) and write a bit of software that monitors these inputs and converts them into USB keyboard controller information, which is then passed back to the computer connected to it. So, step one is to create the USB interface then I’ll hook it up to a <a href="http://raspberrypi.org/?ref=stowe.local">Raspberry Pi</a> that will also live inside the Speccy.</p><p>It’s time to make a wish-list. I might not get all of this done but, hey, it’s nice to have a plan:</p><ul><li>Stand-alone ZX Spectrum emulator powered by a Raspberry Pi (of course)</li><li>Wi-Fi access to the Pi (as the network port is likely to be covered)</li><li>Switchable to USB keyboard for any other device</li><li>Nuclear Power-Station Controller (Hey, Clive said the ZX81 could do it)</li><li>Bluetooth keyboard</li></ul><p>The last one came about as a bluetooth dongle was included with the things I bought. Seems a shame to waste it.</p><p>Let’s get started.</p><p>First off, what’s in box? Well, not much. The Speccy’s motherboard has presumably wandered off in search of new capacitors and 4116 ram. There is, however, a keyboard membrane that needs testing. Of course, we know that the Speccy’s membrane is a resilient beast, easily capable of holding out against the hardest that a dedicated <a href="http://www.thedailymash.co.uk/sport/sport-headlines/daley-thompson-denies-responsibility-for-broken-joysticks-2012072435450?ref=stowe.local">Daley Thompson’s Decathlon</a> player can throw at it. Made you look. Sadly this wasn’t even the later, better Samsung version of the membrane so I made myself a £10 bet it was broken and set about testing it on a Speccy motherboard.</p><p>I won.</p><p>The good news is, it wasn’t all bad. Only track 3 of KB1 (the smaller ribbon) appeared damaged. The ribbon looked like it had been previously trimmed and was pretty ragged. Time for scissors and some supportive insulation tape. There, that’s better:</p><figure class="kg-card kg-image-card kg-card-hascaption"><picture><source type="image/webp" srcset="/images/IMG_2238-2000w.webp 2000w"><img src="/images/IMG_2238-2000w.jpeg" class="kg-image" alt="" loading="lazy" width="2000" height="1500"></picture><figcaption>Brave Little Soldier</figcaption></figure><p>Originally I’d thought the Pi (a model B+) wasn’t going to fit with its tall USB ports. Thankfully it does so in the upper raised area of the case, albeit placing some annoying restrictions on where it can be placed.</p><p>An alternative is the funky new Pi Zero which would fit just about anywhere:</p><figure class="kg-card kg-image-card kg-card-hascaption"><picture><source type="image/webp" srcset="/images/IMG_2231-2000w.webp 2000w"><img src="/images/IMG_2231-2000w.jpeg" class="kg-image" alt="" loading="lazy" width="2000" height="1500"></picture><figcaption>How small?</figcaption></figure><p>Having given this serious consideration, I decided against it as there’s no network connectivity and only one USB port. Still, what a thing!</p><p>Next is a test of the Pro Micro. I’ve made some notes below on the fun of getting this working but I did establish I had a 5v Pro Micro that was working fine and I was able to upload code to it. You could also use an ‘official’ Leonardo for this controller, but it’s a lot larger and would compromise what else you could get in the case.</p><p>Before breaking the soldering iron out, I had a few run-throughs laying out the boards and making sure everything will fit. The two pieces of stripboard you can see will hold the connectors for the keyboard membrane.</p><figure class="kg-card kg-image-card kg-card-hascaption"><picture><source type="image/webp" srcset="/images/IMG_2239-2000w.webp 2000w"><img src="/images/IMG_2239-2000w.jpeg" class="kg-image" alt="" loading="lazy" width="2000" height="1500"></picture><figcaption>That tiny thing is the Pro Micro</figcaption></figure><p>Now, where’s that soldering iron?</p><p><em><a href="http://mrpjevans.com/2015/12/building-the-zx-raspberry-part-two/?ref=stowe.local">On to Part Two…</a></em></p><h3 id="experiences-with-the-pro-micro">Experiences with the Pro Micro</h3><p>I had some fun with the Leonardo-compatible Pro Micro. If you’ve got one of these and, like me, have little idea what you’re doing, then do go ahead and do what I did and brick it almost immediately. Thankfully, they’re hard to upset and can be un-bricked easily.</p><p>These funky little micro-controllers are programmed from a free app from <a href="https://www.arduino.cc/?ref=stowe.local">Arduino</a>, the <a href="https://www.arduino.cc/en/Main/Software?ref=stowe.local">Arduino IDE</a>. You can write code (called a ‘sketch’) and transfer it to the Pro Micro using its USB connection. However, as I learned, it’s vital to have everything set up correctly. The IDE needs an ‘board profile’ file to know how to talk to the Pro Micro. Also, it’s available in two different voltages: 3.3v and 5v. This is normally marked on the back of the board (but not in my case).</p><h5 id="pj-s-top-tips-for-getting-started-with-the-pro-micro">PJ’s top tips for getting started with the Pro Micro</h5><ul><li>Don’t use version 1.6.6 (current at time of writing) of the Arduino IDE, use version 1.6.5 instead. A bug prevents successful upload of the sketch.</li><li>Get the <a href="https://learn.sparkfun.com/tutorials/pro-micro--fio-v3-hookup-guide?ref=stowe.local">correct board profile from Sparkfun</a> before doing anything and follow the installation instructions.</li><li>Pro Micros are available in 3.3v and 5v versions. If you upload a test and have the wrong voltage type selected, things so South, but not too South.</li></ul><p>If you find you  can no longer talk to the Pro Micro:</p><ul><li>Set the board type correctly in the IDE (i.e. the other one)</li><li>Get a small piece of stiff wire</li><li>With the Pro Micro on, carefully short the pins marked GND and RST twice in short succession</li><li>The Pro Micro will now activate its bootloader and create a new COM port on your machine</li><li>You now have eight seconds to go back to the Arduino IDE, select the newly recreated COM port and upload a simple sketch to replace what was there before</li></ul><p>This process takes a few times to get right but once done, the Pro Micro comes back to life.</p><p>When programming (uploading sketches) to the Pro Micro, it will restart, then its USB COM port will disappear only to be replaced by another with a number at the end incremented by 2. This is normal. You’ll need to reselect the port in use each time you upload a sketch. I really wish I’d figured that out sooner.</p>
</article>


<div class="row">
  <div class="col-12 mb-3">
    
      
        <a href="/tags/makes" class="badge rounded-pill text-bg-primary">Makes</a>
      
    
      
        <a href="/tags/raspberry-pi" class="badge rounded-pill text-bg-primary">Raspberry Pi</a>
      
    
      
        <a href="/tags/vintage-tech" class="badge rounded-pill text-bg-primary">Vintage Tech</a>
      
    
      
    
  </div>
</div>
<p class="backlink">
  <a href="/">Home</a>
</p>
					</main>

        </div>

        <div class="row justify-content-md-center p-0">
					
          <footer class="col-md-8 col-sm-12 col-lg-6 footer">

            <hr>

            <div xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
						  
							<a id="rss-icon" href="/feed/feed.xml" aria-label="RSS Feed">
								<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-rss-fill" viewBox="0 0 16 16">
  <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm1.5 2.5c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1 0-2m0 4a6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1 0-2m.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"></path>
</svg>
							</a>

							<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer">
							<span class="cc">
								<picture><source type="image/webp" srcset="/images/by-nc-sa.eu-403w.webp 403w"><img src="/images/by-nc-sa.eu-403w.jpeg" alt="CC BY-NC-SA" width="403" height="141"></picture>
							</span>
						</a>

            <p></p>

          </div></footer>
        </div>

      </div>

    </div>

		<script data-goatcounter="https://mrpjevans.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
  </body>
</html>